[
  {
    "name": "TC-001 S3 event → DynamoDB writer (happy path)",
    "description": "Lambda receives an S3 PutObject event, writes metadata to DynamoDB, and returns 200.",
    "function_name": "s3-processor",
    "handler": "lambda_function.lambda_handler",
    "timeout": 10,
    "memory_size": 128,
    "environment_variables": {
      "TABLE_NAME": "ProcessedFilesTable"
    },
    "setup": {
      "s3_buckets": ["incoming-bucket"],
      "dynamodb_tables": [
        {
          "TableName": "ProcessedFilesTable",
          "KeySchema": [{"AttributeName": "file_id", "KeyType": "HASH"}],
          "AttributeDefinitions": [{"AttributeName": "file_id", "AttributeType": "S"}],
          "BillingMode": "PAY_PER_REQUEST"
        }
      ]
    },
    "trigger_event": {
      "Records": [
        {
          "eventVersion": "2.0",
          "eventSource": "aws:s3",
          "awsRegion": "us-east-1",
          "eventTime": "1970-01-01T00:00:00.000Z",
          "eventName": "ObjectCreated:Put",
          "s3": {
            "s3SchemaVersion": "1.0",
            "configurationId": "testConfigRule",
            "bucket": {
              "name": "incoming-bucket",
              "ownerIdentity": {"principalId": "EXAMPLE"},
              "arn": "arn:aws:s3:::incoming-bucket"
            },
            "object": {
              "key": "test-file.txt",
              "size": 1024,
              "eTag": "0123456789abcdef0123456789abcdef",
              "sequencer": "0A1B2C3D4E5F678901"
            }
          }
        }
      ]
    },
    "validations": {
      "lambda_response": {
        "statusCode": 200,
        "body": "\"File processed successfully\""
      },
      "dynamodb_item": {
        "TableName": "ProcessedFilesTable",
        "Key": {"file_id": {"S": "test-file.txt"}},
        "ExpectedAttributeValue": {
          "status":  {"S": "PROCESSED"},
          "bucket":  {"S": "incoming-bucket"}
        }
      }
    }
  },

  {
    "name": "TC-002 Simple greeting function (happy path)",
    "description": "Lambda returns a customised greeting using GREETING_PREFIX env var.",
    "function_name": "greeter",
    "handler": "lambda_function.lambda_handler_simple",
    "timeout": 5,
    "memory_size": 128,
    "environment_variables": {
      "GREETING_PREFIX": "Hello"
    },
    "setup": {},
    "trigger_event": {"name": "Alice"},
    "validations": {
      "lambda_response": {
        "statusCode": 200,
        "body": "\"Hello, Alice!\""
      }
    }
  },

  {
    "name": "TC-003 Lambda writes output to S3",
    "description": "Lambda receives bucket/key/content and writes an S3 object; validates object content.",
    "function_name": "s3-writer",
    "handler": "lambda_function.lambda_handler_s3_writer",
    "timeout": 10,
    "memory_size": 128,
    "environment_variables": {},
    "setup": {
      "s3_buckets": ["output-bucket"]
    },
    "trigger_event": {
      "bucket":  "output-bucket",
      "key":     "results/report.json",
      "content": "{\"status\": \"ok\"}"
    },
    "validations": {
      "lambda_response": {
        "statusCode": 200,
        "body_contains": "output-bucket"
      },
      "s3_object": {
        "Bucket": "output-bucket",
        "Key":    "results/report.json",
        "ExpectedContent": "{\"status\": \"ok\"}"
      }
    }
  },

  {
    "name": "TC-004 Environment variable passthrough",
    "description": "Validates that all declared environment variables are injected into the Lambda runtime.",
    "function_name": "env-echo",
    "handler": "lambda_function.lambda_handler_env_echo",
    "timeout": 5,
    "memory_size": 128,
    "environment_variables": {
      "APP_ENV":     "test",
      "FEATURE_FLAG": "enabled",
      "MAX_RETRIES": "3"
    },
    "setup": {},
    "trigger_event": {},
    "validations": {
      "lambda_response": {
        "statusCode": 200,
        "body_contains": "APP_ENV"
      }
    }
  },

  {
    "name": "TC-005 Invalid S3 event structure (error path – 400)",
    "description": "Lambda receives a malformed event missing the Records key and should return 400.",
    "function_name": "s3-processor-badrequest",
    "handler": "lambda_function.lambda_handler",
    "timeout": 5,
    "memory_size": 128,
    "environment_variables": {
      "TABLE_NAME": "ProcessedFilesTable"
    },
    "setup": {},
    "trigger_event": {
      "not_records": "this payload is missing the Records key"
    },
    "validations": {
      "lambda_response": {
        "statusCode": 400,
        "body_contains": "Invalid S3 event"
      }
    }
  },

  {
    "name": "TC-006 Missing required env var TABLE_NAME (error path – 500)",
    "description": "Lambda deployed without TABLE_NAME env var should return 500.",
    "function_name": "s3-processor-noenv",
    "handler": "lambda_function.lambda_handler",
    "timeout": 5,
    "memory_size": 128,
    "environment_variables": {},
    "setup": {},
    "trigger_event": {
      "Records": [
        {
          "s3": {
            "bucket": {"name": "any-bucket"},
            "object": {"key": "any-key.txt"}
          }
        }
      ]
    },
    "validations": {
      "lambda_response": {
        "statusCode": 500,
        "body_contains": "TABLE_NAME"
      }
    }
  },

  {
    "name": "TC-007 Unhandled exception triggers FunctionError",
    "description": "Lambda raises an uncaught RuntimeError; FunctionError must be present in the response.",
    "function_name": "raiser",
    "handler": "lambda_function.lambda_handler_raise",
    "timeout": 5,
    "memory_size": 128,
    "environment_variables": {},
    "setup": {},
    "trigger_event": {},
    "validations": {
      "expected_function_error": "Unhandled"
    }
  },

  {
    "name": "TC-008 DynamoDB conditional write – new item created (201)",
    "description": "First write with a unique item_id should succeed and return 201.",
    "function_name": "conditional-writer",
    "handler": "lambda_function.lambda_handler_conditional_write",
    "timeout": 10,
    "memory_size": 128,
    "environment_variables": {
      "TABLE_NAME": "IdempotencyTable"
    },
    "setup": {
      "dynamodb_tables": [
        {
          "TableName": "IdempotencyTable",
          "KeySchema": [{"AttributeName": "item_id", "KeyType": "HASH"}],
          "AttributeDefinitions": [{"AttributeName": "item_id", "AttributeType": "S"}],
          "BillingMode": "PAY_PER_REQUEST"
        }
      ]
    },
    "trigger_event": {
      "item_id": "unique-item-001",
      "value":   "first-write"
    },
    "validations": {
      "lambda_response": {
        "statusCode": 201,
        "body_contains": "created"
      },
      "dynamodb_item": {
        "TableName": "IdempotencyTable",
        "Key": {"item_id": {"S": "unique-item-001"}},
        "ExpectedAttributeValue": {
          "value": {"S": "first-write"}
        }
      }
    }
  }
]
